# Swagger 에 dto 명세 할때 코드 중복을 줄이는 방법
https://ganzicoder.tistory.com/159

일반적으로 

 

entity 에서는 typeorm 에서 사용할수있게 

해당 테이블을 명세한다고 하면

 

dto 는 request, response 의 통로라고 생각을 하면서 

코드를 작성하고있다

 

dto 에서 swagger 관련 데코레이터를 사용하면  (ex : IsString, IsAlphaNumeric) 
유효성 검사도 가능하다

 

하지만 entity 와 dto 파일을 작성하다보면 중복이 꽤나 생긴다

코드의 중복은 절대 줄여야한다 리팩토링의 기본이 중복없는코드...

 

before 와 after 로 생각해보자

 
```
// before entity

@Entity({ name: 'account'})
export class Account extends BaseEntity {
  @PrimaryGeneratedColumn('uuid')
  _id: string;

  @Column({ unique: true })
  uid: string;

  @Column()
  name: string;

  @Column()
  password: string;

  @Column()
  phone: string;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;

  @DeleteDateColumn()
  deletedAt?: Date;
}
```

기본적으로 내가 작성하는 entity 스타일

```
// before dto

export class RegisterAccountDto {
  @ApiProperty({ description: '회원 ID', required: true })
  uid: string;

  @ApiProperty({ description: '회원 비밀 번호', required: true })
  password: string;

  @ApiProperty({ description: '회원 이름', required: true })
  name: string;

  @ApiProperty({ description: '회원 핸드폰 번호', required: true })
  phone: string;

  @ApiProperty({ description: '회원 생일', required: true })
  birth: string;
}
```


두개의 코드를 비교하면 중복이되는 부분이 굉장히 많다

 

그러면 entity 파일에 apiproperty 를 명시하고 dto 에선 사용하고 싶은것들만 선택할순없을까?

 

는 아주 공식문서에 잘 설명되어있다

 

after 코드를 보여드리겠습니다

 
```
// after entity

@Entity({name: 'account' })
export class Account {
  @PrimaryGeneratedColumn('uuid')
  _id: string;
  
  @ApiProperty({
    example: 1,
    description: '사용자 아이디',
  })
  @PrimaryGeneratedColumn({ type: 'int', name: 'id' })
  uid: number;

  @ApiProperty({
    example: '정정원',
    description: '사용자 닉네임',
  })
  @Column('varchar', { name: 'name', length: 30 })
  name: string;
  
   @ApiProperty({
   example: '01012341234',
   description: '사용자 핸드폰 번호',
  })
  @Column('varchar', { name: 'phone', length: 30 })
  phone: string; // number로 하면 앞에 0이 오는경우를 인식못한다

  @ApiProperty({
    example: 123123,
    description: '사용자 비밀번호',
  })
  @Column('varchar', { name: 'password', length: 100, select: false })
  password: string;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;

  @DeleteDateColumn()
  deletedAt: Date | null;
```


이전과 차이가 있다면 entity 에서 ApiProperty 를 명시를 하고있다 그러면 

dto 에서는 어떻게 나타낼까

 
```
// after dto

import { PickType } from '@nestjs/swagger';
import { Account } from 'src/entities/Account';

export class JoinRequestDto extends PickType(Account, [
  'uid',
  'name',
  'password',
  'phone'
] as const) {}
```


PickType 이라는 swagger 데코레이터를 사용해서 

중복되는 코드없이 내가 원하는 dto 를 

작성한 entity 기반으로 만들수있는게 엄청난 장점이다

 

코드가 엄청 줄지않았나요? ㅎㅎ 

 