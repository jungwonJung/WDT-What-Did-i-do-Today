# Nest.js 에서 유닛테스트(Unit test) Jest
https://ganzicoder.tistory.com/135

Nest 에서 jwt 토큰 인증방식을 구현했으나

 

에러가 발생할 요소가 있어서 테스트코드를 작성해보라는 퀘스트를 받았고 

 

테스트코드의 중요성은 익히 알고있었지만 

 

아예 신경 무 인 상태였다가 지금에라도 공부하면서 얻은 지식들을 정리해볼까합니다융

 

그럼 렛스기리온!! 하이 hi~~~

 

 

 

----------------------------------------------------

 

 

테스팅 대상의 범위나 크기에 따라 

 

inteegration, end to end , unit 등으로 테스트 방식을 나눈다

 

유닛테스트는 소프트웨어를 이루고있는 가장 작은 모듈에 대해서 테스트하는것이다

보통 클래스 단위로 진행을 한다

(함수단위로 할때도 있다고합니다)

 

너무 크지않은 범위에서 적절하게 범위를 지정해야한다고 합니다

각 테스트가 독립적인 목표와 상태를 가지고있어서

다른 테스트가 실패하든 성공하든 각각의 테스트는 서로 영향을 받지않아야합니다

테스트가 실패했을때 어느부분에서 버그가 발생한것인지 쉽게 찾을수있기위함

 

controller 나 service 에서 테스트해도 서로 큰차이는 없음

대부분 controller.spec.ts 에서 주로 하는것같다 (오픈소스들이 그랫음)

 

 

 

현 글에서 말하는 테스트코드 작성과 동작은 Jest 를 이용해서 작성하고 동작할예정

 

-- Jest 란 무엇인가융??

Jest 는 js를 위한 간단함이란 장점을 갖고있는 테스팅 프레임웤!!

페이스북에서 만든 오픈 js 테스팅 라이브러리라고 한다

리액트와 리액트 네이티브와 같이 사용하면 좋다고합니다

Jest 는 Babel, TypeScript, Node, React, Angular 와 Vue 같은 프로젝와 사용이가능함!

 

 

velog.io/@rlcjf0014/Jest1-Intro

 
Jest #1 - Intro

Jest Part #1. To be continued...

velog.io
(굉장히 정리가잘되어있는참고자료)

 

 

 

설치는 npm , yarn 을 통해 설치가능하고

package.json 에 script 를 추가하면 알아서 test 파일을 실행한다고 한다

 

- Jest 의 강점

빠른속도는 테스트가 CPU 에 한정될때 매우 유리

 

- Jest가 빠른이유

병렬프로그래밍

가장느린테스트를 먼저 실행하고 이로서 남은 코어들을 최대한 활용

Babel 변환을 캐싱해놓고 CPU를 많이먹는 바벨변환을 줄인다

 

- Jest 에서의 Mocking

모킹은 유닛테스트의 아주 중요한 요소

빠른테스트를 원한다면 매우 중요하다고한다

 

mocking 은 단위 테스트를 작성할때 해당 코드가 의존하는 부분을 가짜(mock)로 대체하는 기법이라고한다

테스트하려는 코드가 의존하는 부분을 직접 생성하기가 너무 부담스러운경우 mocking 을 사용한다고합니다

 

DB에서 데이터를 삭제하는 코드에 대한 유닛테스트를 진행하려고하는데

실제 DB 를 사용하면 아주아주 큰일날수도있음!!

- 테스트를 위한 코드보다 DB와 연결하고 트랜잭션을 생성하고 쿼리를 전송하는코드가

더 길어질수도있다고한다 그러면 배보다 배꼽이 더큰격

-테스트실행순간 일시적으로 DB가 오프라인작업중이였으면 해당 테스트는 무적권 실패

-테스트가 종료 직후 DB에서 변경 데이터를 직접 원복하거나 트랜잭션을 rollback 해줘야하는데

상당히 번거로운 작업이 된다고한다

 

일단 이것은 유닛테스트란 기본적인사상에 몹시몹시 벗어난다고하네유

this is not 유닛테스트!!!

 

 

mocking 은 이런 상황에서 실제 객체인척하는 가짜를 생성하게 도와준다고합니다

테스트 실행중 가짜 객체에 어떤일들이 생기는지 다 기억하기때문에

가짜 객체의 내부가 어떻게 동작하는지 확인도 가능하다고합니다

mocking 을 이용하면 실제객체를 사용하는것보다 빠르고 가볍고 

항상 동일한결과를내는 테스트를 작성할수있다고합니다

 

 

www.daleseo.com/jest-fn-spy-on/

 
[Jest] jest.fn(), jest.spyOn() 함수 모킹

Engineering Blog by Dale Seo

www.daleseo.com
(모킹관련 참고자료)

 

 

 

- JEST API 

jest 로 단위 테스트 코드를 구현할때 자주 사용하는 API 목록

 

- describe ()

여러개의 test()코드를 하나의 테스트작업단위로 묶어주는 API 하나의 테스트케이스를 test()라고 한다면

describe()는 여러개의 테스트 케이스를 하나의 그룹으로 묶어주는 역할

 

- test()

테스트 코드를 돌리기위한 API  하나의 테스트케이스를 의미하고 it() 과 같은역할

 

- expect()

테스트할 대상을 넣는 API  expect()에는 주로 테스트입력값  또는 기대값을 넣는다고 합니다

 

- toBe()

테스트의 결과를 확인하는 API 테스트의 예상 결과 값을 넣는다고합니다

 

- beforeEach()

테스트 파일의 각 테스트 코드가 돌기전에 수행할 로직을 넣는 API 테스트 케이스마다

반복되는 로직을 넣기에 적합

 

일단 필자는 아직 매우매우 익숙치않다 테스트코드 작성도 코딩에 일부분...

너무어렵게 생각하나...

테스트코드를 작성할줄 모르는 개발자는 개발자가 아니라고 생각하고 열심히 해보자!!

빠샤뿌샤!!

 


