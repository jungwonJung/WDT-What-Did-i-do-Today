# Node.js , Mysql CRUD 에서 CR 기능 구현
https://ganzicoder.tistory.com/63


```
// db.js // 

var mysql = require('mysql');


var conn = mysql.createConnection({
    host : "localhost",
    user: "root",
    password: "99189176",
    database: "nodejs-quest", // 선택사항이라고한다
    port:"3306",
})

conn.connect(function(err) {
    if (err) throw err;  // throw err = console.log(error) 과 같은의미
    console.log('data base connect 100%'); // db연동이 된경우에 출력
});

module.exports = conn;

conn.query('SELECT * FROM user', (err, results) => {
    if(err) throw err;
    console.log('DATA RECEIVE:');
    console.log(results);
})
```

```
// app.js //


var express = require('express');
var app = express();
var ejs = require('ejs')
var bodyparser = require('body-parser');
var mysql = require('mysql')
const bodyParser = require('body-parser')

app.set('view engine', 'ejs'); // 뷰엔진으로 npm 설치한 ejs 사용
app.set('views', './views/') // 아직 이해못함

app.get('/', function(request,response){  // 요청받지않은 페이지 홈화면 요청받으면 index.ejs 페이지출력
    response.render('index') // views 안에 index.ejs 렌더링
})

app.use(bodyparser.json());  // bodyparser json 형태로 뿌려주기
app.use(bodyParser.urlencoded({extended:true}));  // 아직이해못함  true 로 설정되면 인코딩된 URL 데이터가 qs 모듈로 분석
                                                // false 면 querystring 으로 인코딩된 데이터 분석

var db = mysql.createConnection({  // 데이터베이스 연동폼 , 
    host : "localhost",
    user: "root",
    password: "99189176",
    database: "nodejs-quest",
    port:"3306",
});
db.connect(); // db connect 함수 시작
// 데이터베이스를 왜썻는가 ?
// fs 파일을 만들어서 데이터를 출력하는것이아닌 sql RDBMS 를 사용하여 데이터를 좀더 간편하게 CRUD 하기위함 

app.listen(3000, function(){ // 3000번포트로 뿌려주면 비동기함수 서버시작한다고 콘솔띄우기
    console.log('서버시작이')
});

app.post('/index', function(req, res){   //  3000/index 로 post 요청 , templates 파일 action 과 동일한 URI
    var data = req.body.des // data 변수안에 요청받은 bodyparser 중에 index.ejs form 안에 des 
    var query = db.query('INSERT INTO user (des) VALUES (?)',[    // user 안에 des 테이블
        data
    ])
    
    var list = db.query('SELECT * FROM user', (err, results) => {  // err, results 콜백함수값으로 
        if(err) throw err;  // err 가있으면 err 를 throw 한다
        console.log('DATA RECEIVE:'); 
        console.log(results); // results 결과값 출력
        res.send(results)
    })
})
```

```
// ./views/index.ejs //

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<h1>퀘스트 아무거나 입력</h1>
<form action="/index" method="post">
    <table>
        <tr>
            <td><input type="text" name="des" placeholder="입력하세요."></td>
        </tr>
    </table>
    <input type="submit" value="입력하기">
</form>
</body>
</html>
```


local 에서 웹페이지를 열어서 입력을 하게되면 

현재 연동된 DB에 데이터 추가 및 DB모든 데이터 반환 한다

